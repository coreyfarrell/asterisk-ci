<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - Asterisk GIT-16-9767e98486 - main/strings.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">main</a> - strings.c<span style="font-size: 80%;"> (source / <a href="strings.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">Asterisk GIT-16-9767e98486</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">153</td>
            <td class="headerCovTableEntry">183</td>
            <td class="headerCovTableEntryMed">83.6 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2018-07-22 22:16:30</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntry">12</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  * Asterisk -- An open source telephony toolkit.
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  * Copyright (C) 2008, Digium, Inc.
<span class="lineNum">       5 </span>            :  *
<span class="lineNum">       6 </span>            :  * Tilghman Lesher &lt;tlesher@digium.com&gt;
<span class="lineNum">       7 </span>            :  *
<span class="lineNum">       8 </span>            :  * See http://www.asterisk.org for more information about
<span class="lineNum">       9 </span>            :  * the Asterisk project. Please do not directly contact
<span class="lineNum">      10 </span>            :  * any of the maintainers of this project for assistance;
<span class="lineNum">      11 </span>            :  * the project provides a web site, mailing lists and IRC
<span class="lineNum">      12 </span>            :  * channels for your use.
<span class="lineNum">      13 </span>            :  *
<span class="lineNum">      14 </span>            :  * This program is free software, distributed under the terms of
<span class="lineNum">      15 </span>            : * the GNU General Public License Version 2. See the LICENSE file
<span class="lineNum">      16 </span>            :  * at the top of the source tree.
<span class="lineNum">      17 </span>            :  */
<span class="lineNum">      18 </span>            : 
<span class="lineNum">      19 </span>            : /*! \file
<span class="lineNum">      20 </span>            :  *
<span class="lineNum">      21 </span>            :  * \brief String manipulation API
<span class="lineNum">      22 </span>            :  *
<span class="lineNum">      23 </span>            :  * \author Tilghman Lesher &lt;tilghman@digium.com&gt;
<span class="lineNum">      24 </span>            :  */
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : /*** MAKEOPTS
<span class="lineNum">      27 </span>            : &lt;category name=&quot;MENUSELECT_CFLAGS&quot; displayname=&quot;Compiler Flags&quot; positive_output=&quot;yes&quot;&gt;
<span class="lineNum">      28 </span>            :         &lt;member name=&quot;DEBUG_OPAQUE&quot; displayname=&quot;Change ast_str internals to detect improper usage&quot; touch_on_change=&quot;include/asterisk/strings.h&quot;&gt;
<span class="lineNum">      29 </span>            :                 &lt;defaultenabled&gt;yes&lt;/defaultenabled&gt;
<span class="lineNum">      30 </span>            :         &lt;/member&gt;
<span class="lineNum">      31 </span>            : &lt;/category&gt;
<span class="lineNum">      32 </span>            :  ***/
<span class="lineNum">      33 </span>            : 
<span class="lineNum">      34 </span>            : /*** MODULEINFO
<span class="lineNum">      35 </span>            :         &lt;support_level&gt;core&lt;/support_level&gt;
<span class="lineNum">      36 </span>            :  ***/
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            : #include &quot;asterisk.h&quot;
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : #include &lt;regex.h&gt;
<span class="lineNum">      41 </span>            : #include &quot;asterisk/strings.h&quot;
<span class="lineNum">      42 </span>            : #include &quot;asterisk/pbx.h&quot;
<span class="lineNum">      43 </span>            : #include &quot;asterisk/vector.h&quot;
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : /*!
<span class="lineNum">      46 </span>            :  * core handler for dynamic strings.
<span class="lineNum">      47 </span>            :  * This is not meant to be called directly, but rather through the
<span class="lineNum">      48 </span>            :  * various wrapper macros
<span class="lineNum">      49 </span>            :  *      ast_str_set(...)
<span class="lineNum">      50 </span>            :  *      ast_str_append(...)
<span class="lineNum">      51 </span>            :  *      ast_str_set_va(...)
<span class="lineNum">      52 </span>            :  *      ast_str_append_va(...)
<a name="53"><span class="lineNum">      53 </span>            :  */</a>
<span class="lineNum">      54 </span>            : 
<span class="lineNum">      55 </span><span class="lineCov">  674631154 : int __ast_str_helper(struct ast_str **buf, ssize_t max_len,</span>
<span class="lineNum">      56 </span>            :         int append, const char *fmt, va_list ap,
<span class="lineNum">      57 </span>            :         const char *file, int lineno, const char *function)
<span class="lineNum">      58 </span>            : {
<span class="lineNum">      59 </span>            :         int res;
<span class="lineNum">      60 </span>            :         int added;
<span class="lineNum">      61 </span>            :         int need;
<span class="lineNum">      62 </span><span class="lineCov">  674631154 :         int offset = (append &amp;&amp; (*buf)-&gt;__AST_STR_LEN) ? (*buf)-&gt;__AST_STR_USED : 0;</span>
<span class="lineNum">      63 </span>            :         va_list aq;
<span class="lineNum">      64 </span>            : 
<span class="lineNum">      65 </span><span class="lineCov">  674631154 :         if (max_len &lt; 0) {</span>
<span class="lineNum">      66 </span><span class="lineCov">        415 :                 max_len = (*buf)-&gt;__AST_STR_LEN;     /* don't exceed the allocated space */</span>
<span class="lineNum">      67 </span>            :         }
<span class="lineNum">      68 </span>            : 
<span class="lineNum">      69 </span>            :         do {
<span class="lineNum">      70 </span><span class="lineCov">   13640115 :                 va_copy(aq, ap);</span>
<span class="lineNum">      71 </span><span class="lineCov">  688271269 :                 res = vsnprintf((*buf)-&gt;__AST_STR_STR + offset, (*buf)-&gt;__AST_STR_LEN - offset, fmt, aq);</span>
<span class="lineNum">      72 </span><span class="lineCov">  688271269 :                 va_end(aq);</span>
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span><span class="lineCov">  688271269 :                 if (res &lt; 0) {</span>
<span class="lineNum">      75 </span>            :                         /*
<span class="lineNum">      76 </span>            :                          * vsnprintf write to string failed.
<span class="lineNum">      77 </span>            :                          * I don't think this is possible with a memory buffer.
<span class="lineNum">      78 </span>            :                          */
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :                         res = AST_DYNSTR_BUILD_FAILED;</span>
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :                         added = 0;</span>
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">      82 </span>            :                 }
<span class="lineNum">      83 </span>            : 
<span class="lineNum">      84 </span>            :                 /*
<span class="lineNum">      85 </span>            :                  * vsnprintf returns how much space we used or would need.
<span class="lineNum">      86 </span>            :                  * Remember that vsnprintf does not count the nil terminator
<span class="lineNum">      87 </span>            :                  * so we must add 1.
<span class="lineNum">      88 </span>            :                  */
<span class="lineNum">      89 </span><span class="lineCov">  688271269 :                 added = res;</span>
<span class="lineNum">      90 </span><span class="lineCov">  688271269 :                 need = offset + added + 1;</span>
<span class="lineNum">      91 </span><span class="lineCov">  688271269 :                 if (need &lt;= (*buf)-&gt;__AST_STR_LEN</span>
<span class="lineNum">      92 </span><span class="lineCov">   13640119 :                         || (max_len &amp;&amp; max_len &lt;= (*buf)-&gt;__AST_STR_LEN)) {</span>
<span class="lineNum">      93 </span>            :                         /*
<span class="lineNum">      94 </span>            :                          * There was enough room for the string or we are not
<span class="lineNum">      95 </span>            :                          * allowed to try growing the string buffer.
<span class="lineNum">      96 </span>            :                          */
<span class="lineNum">      97 </span>            :                         break;
<span class="lineNum">      98 </span>            :                 }
<span class="lineNum">      99 </span>            : 
<span class="lineNum">     100 </span>            :                 /* Reallocate the buffer and try again. */
<span class="lineNum">     101 </span><span class="lineCov">   13640115 :                 if (max_len == 0) {</span>
<span class="lineNum">     102 </span>            :                         /* unbounded, give more room for next time */
<span class="lineNum">     103 </span><span class="lineCov">   13630764 :                         need += 16 + need / 4;</span>
<span class="lineNum">     104 </span><span class="lineCov">       9351 :                 } else if (max_len &lt; need) {</span>
<span class="lineNum">     105 </span>            :                         /* truncate as needed */
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :                         need = max_len;</span>
<span class="lineNum">     107 </span>            :                 }
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span><span class="lineCov">   13640115 :                 if (_ast_str_make_space(buf, need, file, lineno, function)) {</span>
<span class="lineNum">     110 </span><span class="lineNoCov">          0 :                         ast_log_safe(LOG_VERBOSE, &quot;failed to extend from %d to %d\n&quot;,</span>
<span class="lineNum">     111 </span><span class="lineNoCov">          0 :                                 (int) (*buf)-&gt;__AST_STR_LEN, need);</span>
<span class="lineNum">     112 </span>            : 
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :                         res = AST_DYNSTR_BUILD_FAILED;</span>
<span class="lineNum">     114 </span><span class="lineNoCov">          0 :                         break;</span>
<span class="lineNum">     115 </span>            :                 }
<span class="lineNum">     116 </span>            :         } while (1);
<span class="lineNum">     117 </span>            : 
<span class="lineNum">     118 </span>            :         /* Update space used, keep in mind truncation may be necessary. */
<span class="lineNum">     119 </span><span class="lineCov"> 1349262308 :         (*buf)-&gt;__AST_STR_USED = ((*buf)-&gt;__AST_STR_LEN &lt;= offset + added)</span>
<span class="lineNum">     120 </span><span class="lineCov">          4 :                 ? (*buf)-&gt;__AST_STR_LEN - 1</span>
<span class="lineNum">     121 </span><span class="lineCov">  674631154 :                 : offset + added;</span>
<span class="lineNum">     122 </span>            : 
<span class="lineNum">     123 </span>            :         /* Ensure that the string is terminated. */
<span class="lineNum">     124 </span><span class="lineCov">  674631154 :         (*buf)-&gt;__AST_STR_STR[(*buf)-&gt;__AST_STR_USED] = '\0';</span>
<span class="lineNum">     125 </span>            : 
<span class="lineNum">     126 </span><span class="lineCov">  674631154 :         return res;</span>
<a name="127"><span class="lineNum">     127 </span>            : }</a>
<span class="lineNum">     128 </span>            : 
<span class="lineNum">     129 </span><span class="lineCov">    5418171 : char *__ast_str_helper2(struct ast_str **buf, ssize_t maxlen, const char *src, size_t maxsrc, int append, int escapecommas)</span>
<span class="lineNum">     130 </span>            : {
<span class="lineNum">     131 </span><span class="lineCov">    5418171 :         int dynamic = 0;</span>
<span class="lineNum">     132 </span><span class="lineCov">    5418171 :         char *ptr = append ? &amp;((*buf)-&gt;__AST_STR_STR[(*buf)-&gt;__AST_STR_USED]) : (*buf)-&gt;__AST_STR_STR;</span>
<span class="lineNum">     133 </span>            : 
<span class="lineNum">     134 </span><span class="lineCov">    5418171 :         if (maxlen &lt; 1) {</span>
<span class="lineNum">     135 </span><span class="lineCov">    5418166 :                 if (maxlen == 0) {</span>
<span class="lineNum">     136 </span><span class="lineCov">    5329726 :                         dynamic = 1;</span>
<span class="lineNum">     137 </span>            :                 }
<span class="lineNum">     138 </span><span class="lineCov">    5418166 :                 maxlen = (*buf)-&gt;__AST_STR_LEN;</span>
<span class="lineNum">     139 </span>            :         }
<span class="lineNum">     140 </span>            : 
<span class="lineNum">     141 </span><span class="lineCov">  161077716 :         while (*src &amp;&amp; maxsrc &amp;&amp; maxlen &amp;&amp; (!escapecommas || (maxlen - 1))) {</span>
<span class="lineNum">     142 </span><span class="lineCov">  155659545 :                 if (escapecommas &amp;&amp; (*src == '\\' || *src == ',')) {</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :                         *ptr++ = '\\';</span>
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :                         maxlen--;</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :                         (*buf)-&gt;__AST_STR_USED++;</span>
<span class="lineNum">     146 </span>            :                 }
<span class="lineNum">     147 </span><span class="lineCov">  155659545 :                 *ptr++ = *src++;</span>
<span class="lineNum">     148 </span><span class="lineCov">  155659545 :                 maxsrc--;</span>
<span class="lineNum">     149 </span><span class="lineCov">  155659545 :                 maxlen--;</span>
<span class="lineNum">     150 </span><span class="lineCov">  155659545 :                 (*buf)-&gt;__AST_STR_USED++;</span>
<span class="lineNum">     151 </span>            : 
<span class="lineNum">     152 </span><span class="lineCov">  155659545 :                 if ((ptr &gt;= (*buf)-&gt;__AST_STR_STR + (*buf)-&gt;__AST_STR_LEN - 3) ||</span>
<span class="lineNum">     153 </span><span class="lineCov">  155021642 :                         (dynamic &amp;&amp; (!maxlen || (escapecommas &amp;&amp; !(maxlen - 1))))) {</span>
<span class="lineNum">     154 </span><span class="lineCov">     415977 :                         char *oldbase = (*buf)-&gt;__AST_STR_STR;</span>
<span class="lineNum">     155 </span><span class="lineCov">     415977 :                         size_t old = (*buf)-&gt;__AST_STR_LEN;</span>
<span class="lineNum">     156 </span><span class="lineCov">     415977 :                         if (ast_str_make_space(buf, (*buf)-&gt;__AST_STR_LEN * 2)) {</span>
<span class="lineNum">     157 </span>            :                                 /* If the buffer can't be extended, end it. */
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :                                 break;</span>
<span class="lineNum">     159 </span>            :                         }
<span class="lineNum">     160 </span>            :                         /* What we extended the buffer by */
<span class="lineNum">     161 </span><span class="lineCov">     415977 :                         maxlen = old;</span>
<span class="lineNum">     162 </span>            : 
<span class="lineNum">     163 </span><span class="lineCov">     415977 :                         ptr += (*buf)-&gt;__AST_STR_STR - oldbase;</span>
<span class="lineNum">     164 </span>            :                 }
<span class="lineNum">     165 </span>            :         }
<span class="lineNum">     166 </span><span class="lineCov">    5418171 :         if (__builtin_expect(!maxlen, 0)) {</span>
<span class="lineNum">     167 </span><span class="lineNoCov">          0 :                 ptr--;</span>
<span class="lineNum">     168 </span>            :         }
<span class="lineNum">     169 </span><span class="lineCov">    5418171 :         *ptr = '\0';</span>
<span class="lineNum">     170 </span><span class="lineCov">    5418171 :         return (*buf)-&gt;__AST_STR_STR;</span>
<a name="171"><span class="lineNum">     171 </span>            : }</a>
<span class="lineNum">     172 </span>            : 
<span class="lineNum">     173 </span><span class="lineCov">     177557 : static int str_hash(const void *obj, const int flags)</span>
<span class="lineNum">     174 </span>            : {
<span class="lineNum">     175 </span><span class="lineCov">     177557 :         return ast_str_hash(obj);</span>
<a name="176"><span class="lineNum">     176 </span>            : }</a>
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span><span class="lineCov">       7266 : static int str_sort(const void *lhs, const void *rhs, int flags)</span>
<span class="lineNum">     179 </span>            : {
<span class="lineNum">     180 </span><span class="lineCov">       7266 :         if ((flags &amp; OBJ_SEARCH_MASK) == OBJ_SEARCH_PARTIAL_KEY) {</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :                 return strncmp(lhs, rhs, strlen(rhs));</span>
<span class="lineNum">     182 </span>            :         } else {
<span class="lineNum">     183 </span><span class="lineCov">       7266 :                 return strcmp(lhs, rhs);</span>
<span class="lineNum">     184 </span>            :         }
<a name="185"><span class="lineNum">     185 </span>            : }</a>
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span><span class="lineCov">       3677 : static int str_cmp(void *lhs, void *rhs, int flags)</span>
<span class="lineNum">     188 </span>            : {
<span class="lineNum">     189 </span><span class="lineCov">       3677 :         int cmp = 0;</span>
<span class="lineNum">     190 </span>            : 
<span class="lineNum">     191 </span><span class="lineCov">       3677 :         if ((flags &amp; OBJ_SEARCH_MASK) == OBJ_SEARCH_PARTIAL_KEY) {</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :                 cmp = strncmp(lhs, rhs, strlen(rhs));</span>
<span class="lineNum">     193 </span>            :         } else {
<span class="lineNum">     194 </span><span class="lineCov">       3677 :                 cmp = strcmp(lhs, rhs);</span>
<span class="lineNum">     195 </span>            :         }
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span><span class="lineCov">       3677 :         return cmp ? 0 : CMP_MATCH;</span>
<span class="lineNum">     198 </span>            : }
<a name="199"><span class="lineNum">     199 </span>            : </a>
<span class="lineNum">     200 </span>            : //struct ao2_container *ast_str_container_alloc_options(enum ao2_container_opts opts, int buckets)
<span class="lineNum">     201 </span><span class="lineCov">      18087 : struct ao2_container *ast_str_container_alloc_options(enum ao2_alloc_opts opts, int buckets)</span>
<span class="lineNum">     202 </span>            : {
<span class="lineNum">     203 </span><span class="lineCov">      18087 :         return ao2_container_alloc_hash(opts, 0, buckets, str_hash, str_sort, str_cmp);</span>
<a name="204"><span class="lineNum">     204 </span>            : }</a>
<span class="lineNum">     205 </span>            : 
<span class="lineNum">     206 </span><span class="lineCov">      21168 : int ast_str_container_add(struct ao2_container *str_container, const char *add)</span>
<span class="lineNum">     207 </span>            : {
<span class="lineNum">     208 </span>            :         char *ao2_add;
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span>            :         /* The ao2_add object is immutable so it doesn't need a lock of its own. */
<span class="lineNum">     211 </span><span class="lineCov">      21168 :         ao2_add = ao2_alloc_options(strlen(add) + 1, NULL, AO2_ALLOC_OPT_LOCK_NOLOCK);</span>
<span class="lineNum">     212 </span><span class="lineCov">      21168 :         if (!ao2_add) {</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 :                 return -1;</span>
<span class="lineNum">     214 </span>            :         }
<span class="lineNum">     215 </span><span class="lineCov">      21168 :         strcpy(ao2_add, add);/* Safe */</span>
<span class="lineNum">     216 </span>            : 
<span class="lineNum">     217 </span><span class="lineCov">      21168 :         ao2_link(str_container, ao2_add);</span>
<span class="lineNum">     218 </span><span class="lineCov">      21168 :         ao2_ref(ao2_add, -1);</span>
<span class="lineNum">     219 </span><span class="lineCov">      21168 :         return 0;</span>
<a name="220"><span class="lineNum">     220 </span>            : }</a>
<span class="lineNum">     221 </span>            : 
<span class="lineNum">     222 </span><span class="lineCov">       1815 : void ast_str_container_remove(struct ao2_container *str_container, const char *remove)</span>
<span class="lineNum">     223 </span>            : {
<span class="lineNum">     224 </span><span class="lineCov">       1815 :         ao2_find(str_container, remove, OBJ_SEARCH_KEY | OBJ_NODATA | OBJ_UNLINK);</span>
<a name="225"><span class="lineNum">     225 </span><span class="lineCov">       1815 : }</span></a>
<span class="lineNum">     226 </span>            : 
<span class="lineNum">     227 </span><span class="lineCov">          1 : char *ast_generate_random_string(char *buf, size_t size)</span>
<span class="lineNum">     228 </span>            : {
<span class="lineNum">     229 </span>            :         int i;
<span class="lineNum">     230 </span>            : 
<span class="lineNum">     231 </span><span class="lineCov">          8 :         for (i = 0; i &lt; size - 1; ++i) {</span>
<span class="lineNum">     232 </span><span class="lineCov">          7 :                 buf[i] = 'a' + (ast_random() % 26);</span>
<span class="lineNum">     233 </span>            :         }
<span class="lineNum">     234 </span><span class="lineCov">          1 :         buf[i] = '\0';</span>
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span><span class="lineCov">          1 :         return buf;</span>
<a name="237"><span class="lineNum">     237 </span>            : }</a>
<span class="lineNum">     238 </span>            : 
<span class="lineNum">     239 </span><span class="lineCov">       1028 : int ast_strings_match(const char *left, const char *op, const char *right)</span>
<span class="lineNum">     240 </span>            : {
<span class="lineNum">     241 </span><span class="lineCov">       1028 :         char *internal_op = (char *)op;</span>
<span class="lineNum">     242 </span><span class="lineCov">       1028 :         char *internal_right = (char *)right;</span>
<span class="lineNum">     243 </span>            :         double left_num;
<span class="lineNum">     244 </span>            :         double right_num;
<span class="lineNum">     245 </span><span class="lineCov">       1028 :         int scan_numeric = 0;</span>
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span><span class="lineCov">       1028 :         if (!(left &amp;&amp; right)) {</span>
<span class="lineNum">     248 </span><span class="lineCov">          5 :                 return 0;</span>
<span class="lineNum">     249 </span>            :         }
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span><span class="lineCov">       1023 :         if (ast_strlen_zero(op)) {</span>
<span class="lineNum">     252 </span><span class="lineCov">         32 :                 if (ast_strlen_zero(left) &amp;&amp; ast_strlen_zero(right)) {</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :                         return 1;</span>
<span class="lineNum">     254 </span>            :                 }
<span class="lineNum">     255 </span>            : 
<span class="lineNum">     256 </span><span class="lineCov">         32 :                 if (strlen(right) &gt;= 2 &amp;&amp; right[0] == '/' &amp;&amp; right[strlen(right) - 1] == '/') {</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :                         internal_op = &quot;regex&quot;;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :                         internal_right = ast_strdupa(right);</span>
<span class="lineNum">     259 </span>            :                         /* strip the leading and trailing '/' */
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :                         internal_right++;</span>
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :                         internal_right[strlen(internal_right) - 1] = '\0';</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :                         goto regex;</span>
<span class="lineNum">     263 </span>            :                 } else {
<span class="lineNum">     264 </span><span class="lineCov">         32 :                         internal_op = &quot;=&quot;;</span>
<span class="lineNum">     265 </span><span class="lineCov">         32 :                         goto equals;</span>
<span class="lineNum">     266 </span>            :                 }
<span class="lineNum">     267 </span>            :         }
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span><span class="lineCov">        991 :         if (!strcasecmp(op, &quot;like&quot;)) {</span>
<span class="lineNum">     270 </span>            :                 char *tok;
<span class="lineNum">     271 </span><span class="lineCov">          9 :                 struct ast_str *buffer = ast_str_alloca(128);</span>
<span class="lineNum">     272 </span>            : 
<span class="lineNum">     273 </span><span class="lineCov">          9 :                 if (!strchr(right, '%')) {</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :                         return !strcmp(left, right);</span>
<span class="lineNum">     275 </span>            :                 } else {
<span class="lineNum">     276 </span><span class="lineCov">          9 :                         internal_op = &quot;regex&quot;;</span>
<span class="lineNum">     277 </span><span class="lineCov">          9 :                         internal_right = ast_strdupa(right);</span>
<span class="lineNum">     278 </span><span class="lineCov">          9 :                         tok = strsep(&amp;internal_right, &quot;%&quot;);</span>
<span class="lineNum">     279 </span><span class="lineCov">          9 :                         ast_str_set(&amp;buffer, 0, &quot;^%s&quot;, tok);</span>
<span class="lineNum">     280 </span>            : 
<span class="lineNum">     281 </span><span class="lineCov">         25 :                         while ((tok = strsep(&amp;internal_right, &quot;%&quot;))) {</span>
<span class="lineNum">     282 </span><span class="lineCov">         16 :                                 ast_str_append(&amp;buffer, 0, &quot;.*%s&quot;, tok);</span>
<span class="lineNum">     283 </span>            :                         }
<span class="lineNum">     284 </span><span class="lineCov">          9 :                         ast_str_append(&amp;buffer, 0, &quot;%s&quot;, &quot;$&quot;);</span>
<span class="lineNum">     285 </span>            : 
<span class="lineNum">     286 </span><span class="lineCov">          9 :                         internal_right = ast_str_buffer(buffer);</span>
<span class="lineNum">     287 </span>            :                         /* fall through to regex */
<span class="lineNum">     288 </span>            :                 }
<span class="lineNum">     289 </span>            :         }
<span class="lineNum">     290 </span>            : 
<span class="lineNum">     291 </span><span class="lineCov">        982 : regex:</span>
<span class="lineNum">     292 </span><span class="lineCov">        991 :         if (!strcasecmp(internal_op, &quot;regex&quot;)) {</span>
<span class="lineNum">     293 </span>            :                 regex_t expression;
<span class="lineNum">     294 </span>            :                 int rc;
<span class="lineNum">     295 </span>            : 
<span class="lineNum">     296 </span><span class="lineCov">         11 :                 if (regcomp(&amp;expression, internal_right, REG_EXTENDED | REG_NOSUB)) {</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :                         return 0;</span>
<span class="lineNum">     298 </span>            :                 }
<span class="lineNum">     299 </span>            : 
<span class="lineNum">     300 </span><span class="lineCov">         11 :                 rc = regexec(&amp;expression, left, 0, NULL, 0);</span>
<span class="lineNum">     301 </span><span class="lineCov">         11 :                 regfree(&amp;expression);</span>
<span class="lineNum">     302 </span><span class="lineCov">         11 :                 return !rc;</span>
<span class="lineNum">     303 </span>            :         }
<span class="lineNum">     304 </span>            : 
<span class="lineNum">     305 </span><span class="lineCov">        980 : equals:</span>
<span class="lineNum">     306 </span><span class="lineCov">       1012 :         scan_numeric = (sscanf(left, &quot;%lf&quot;, &amp;left_num) &gt; 0 &amp;&amp; sscanf(internal_right, &quot;%lf&quot;, &amp;right_num) &gt; 0);</span>
<span class="lineNum">     307 </span>            : 
<span class="lineNum">     308 </span><span class="lineCov">       1012 :         if (internal_op[0] == '=') {</span>
<span class="lineNum">     309 </span><span class="lineCov">         37 :                 if (ast_strlen_zero(left) &amp;&amp; ast_strlen_zero(internal_right)) {</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :                         return 1;</span>
<span class="lineNum">     311 </span>            :                 }
<span class="lineNum">     312 </span>            : 
<span class="lineNum">     313 </span><span class="lineCov">         37 :                 if (scan_numeric) {</span>
<span class="lineNum">     314 </span><span class="lineCov">         24 :                         return (left_num == right_num);</span>
<span class="lineNum">     315 </span>            :                 } else {
<span class="lineNum">     316 </span><span class="lineCov">         13 :                         return (!strcmp(left, internal_right));</span>
<span class="lineNum">     317 </span>            :                 }
<span class="lineNum">     318 </span>            :         }
<span class="lineNum">     319 </span>            : 
<span class="lineNum">     320 </span><span class="lineCov">        975 :         if (internal_op[0] == '!' &amp;&amp; internal_op[1] == '=') {</span>
<span class="lineNum">     321 </span><span class="lineCov">        850 :                 if (scan_numeric) {</span>
<span class="lineNum">     322 </span><span class="lineCov">          1 :                         return (left_num != right_num);</span>
<span class="lineNum">     323 </span>            :                 } else {
<span class="lineNum">     324 </span><span class="lineCov">        849 :                         return !!strcmp(left, internal_right);</span>
<span class="lineNum">     325 </span>            :                 }
<span class="lineNum">     326 </span>            :         }
<span class="lineNum">     327 </span>            : 
<span class="lineNum">     328 </span><span class="lineCov">        125 :         if (internal_op[0] == '&lt;') {</span>
<span class="lineNum">     329 </span><span class="lineCov">        113 :                 if (scan_numeric) {</span>
<span class="lineNum">     330 </span><span class="lineCov">        109 :                         if (internal_op[1] == '=') {</span>
<span class="lineNum">     331 </span><span class="lineCov">        107 :                                 return (left_num &lt;= right_num);</span>
<span class="lineNum">     332 </span>            :                         } else {
<span class="lineNum">     333 </span><span class="lineCov">          2 :                                 return (left_num &lt; right_num);</span>
<span class="lineNum">     334 </span>            :                         }
<span class="lineNum">     335 </span>            :                 } else {
<span class="lineNum">     336 </span><span class="lineCov">          4 :                         if (internal_op[1] == '=') {</span>
<span class="lineNum">     337 </span><span class="lineCov">          2 :                                 return strcmp(left, internal_right) &lt;= 0;</span>
<span class="lineNum">     338 </span>            :                         } else {
<span class="lineNum">     339 </span><span class="lineCov">          2 :                                 return strcmp(left, internal_right) &lt; 0;</span>
<span class="lineNum">     340 </span>            :                         }
<span class="lineNum">     341 </span>            :                 }
<span class="lineNum">     342 </span>            :         }
<span class="lineNum">     343 </span>            : 
<span class="lineNum">     344 </span><span class="lineCov">         12 :         if (internal_op[0] == '&gt;') {</span>
<span class="lineNum">     345 </span><span class="lineCov">         12 :                 if (scan_numeric) {</span>
<span class="lineNum">     346 </span><span class="lineCov">          7 :                         if (internal_op[1] == '=') {</span>
<span class="lineNum">     347 </span><span class="lineCov">          2 :                                 return (left_num &gt;= right_num);</span>
<span class="lineNum">     348 </span>            :                         } else {
<span class="lineNum">     349 </span><span class="lineCov">          5 :                                 return (left_num &gt; right_num);</span>
<span class="lineNum">     350 </span>            :                         }
<span class="lineNum">     351 </span>            :                 } else {
<span class="lineNum">     352 </span><span class="lineCov">          5 :                         if (internal_op[1] == '=') {</span>
<span class="lineNum">     353 </span><span class="lineCov">          2 :                                 return strcmp(left, internal_right) &gt;= 0;</span>
<span class="lineNum">     354 </span>            :                         } else {
<span class="lineNum">     355 </span><span class="lineCov">          3 :                                 return strcmp(left, internal_right) &gt; 0;</span>
<span class="lineNum">     356 </span>            :                         }
<span class="lineNum">     357 </span>            :                 }
<span class="lineNum">     358 </span>            :         }
<span class="lineNum">     359 </span>            : 
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :         return 0;</span>
<a name="361"><span class="lineNum">     361 </span>            : }</a>
<span class="lineNum">     362 </span>            : 
<span class="lineNum">     363 </span><span class="lineCov">          5 : char *ast_read_line_from_buffer(char **buffer)</span>
<span class="lineNum">     364 </span>            : {
<span class="lineNum">     365 </span><span class="lineCov">          5 :         char *start = *buffer;</span>
<span class="lineNum">     366 </span>            : 
<span class="lineNum">     367 </span><span class="lineCov">          5 :         if (!buffer || !*buffer || *(*buffer) == '\0') {</span>
<span class="lineNum">     368 </span><span class="lineCov">          1 :                 return NULL;</span>
<span class="lineNum">     369 </span>            :         }
<span class="lineNum">     370 </span>            : 
<span class="lineNum">     371 </span><span class="lineCov">         95 :         while (*(*buffer) &amp;&amp; *(*buffer) != '\n' ) {</span>
<span class="lineNum">     372 </span><span class="lineCov">         91 :                 (*buffer)++;</span>
<span class="lineNum">     373 </span>            :         }
<span class="lineNum">     374 </span>            : 
<span class="lineNum">     375 </span><span class="lineCov">          4 :         *(*buffer) = '\0';</span>
<span class="lineNum">     376 </span><span class="lineCov">          4 :         if (*(*buffer - 1) == '\r') {</span>
<span class="lineNum">     377 </span><span class="lineCov">          3 :                 *(*buffer - 1) = '\0';</span>
<span class="lineNum">     378 </span>            :         }
<span class="lineNum">     379 </span><span class="lineCov">          4 :         (*buffer)++;</span>
<span class="lineNum">     380 </span>            : 
<span class="lineNum">     381 </span><span class="lineCov">          4 :         return start;</span>
<a name="382"><span class="lineNum">     382 </span>            : }</a>
<span class="lineNum">     383 </span>            : 
<span class="lineNum">     384 </span><span class="lineCov">    1080402 : int ast_vector_string_split(struct ast_vector_string *dest,</span>
<span class="lineNum">     385 </span>            :         const char *input, const char *delim, int flags,
<span class="lineNum">     386 </span>            :         int (*excludes_cmp)(const char *s1, const char *s2))
<span class="lineNum">     387 </span>            : {
<span class="lineNum">     388 </span>            :         char *buf;
<span class="lineNum">     389 </span>            :         char *cur;
<span class="lineNum">     390 </span><span class="lineCov">    1080402 :         int no_trim = flags &amp; AST_VECTOR_STRING_SPLIT_NO_TRIM;</span>
<span class="lineNum">     391 </span><span class="lineCov">    1080402 :         int allow_empty = flags &amp; AST_VECTOR_STRING_SPLIT_ALLOW_EMPTY;</span>
<span class="lineNum">     392 </span>            : 
<span class="lineNum">     393 </span><span class="lineCov">    1080402 :         ast_assert(dest != NULL);</span>
<span class="lineNum">     394 </span><span class="lineCov">    1080402 :         ast_assert(!ast_strlen_zero(delim));</span>
<span class="lineNum">     395 </span>            : 
<span class="lineNum">     396 </span><span class="lineCov">    1080402 :         if (ast_strlen_zero(input)) {</span>
<span class="lineNum">     397 </span><span class="lineCov">     973701 :                 return 0;</span>
<span class="lineNum">     398 </span>            :         }
<span class="lineNum">     399 </span>            : 
<span class="lineNum">     400 </span><span class="lineCov">     106701 :         buf = ast_strdupa(input);</span>
<span class="lineNum">     401 </span><span class="lineCov">     290320 :         while ((cur = strsep(&amp;buf, delim))) {</span>
<span class="lineNum">     402 </span><span class="lineCov">     183619 :                 if (!no_trim) {</span>
<span class="lineNum">     403 </span><span class="lineCov">     183619 :                         cur = ast_strip(cur);</span>
<span class="lineNum">     404 </span>            :                 }
<span class="lineNum">     405 </span>            : 
<span class="lineNum">     406 </span><span class="lineCov">     183619 :                 if (!allow_empty &amp;&amp; ast_strlen_zero(cur)) {</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :                         continue;</span>
<span class="lineNum">     408 </span>            :                 }
<span class="lineNum">     409 </span>            : 
<span class="lineNum">     410 </span><span class="lineCov">     310437 :                 if (excludes_cmp &amp;&amp; AST_VECTOR_GET_CMP(dest, cur, !excludes_cmp)) {</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :                         continue;</span>
<span class="lineNum">     412 </span>            :                 }
<span class="lineNum">     413 </span>            : 
<span class="lineNum">     414 </span><span class="lineCov">     183619 :                 cur = ast_strdup(cur);</span>
<span class="lineNum">     415 </span><span class="lineCov">     183619 :                 if (!cur || AST_VECTOR_APPEND(dest, cur)) {</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :                         ast_free(cur);</span>
<span class="lineNum">     417 </span>            : 
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :                         return -1;</span>
<span class="lineNum">     419 </span>            :                 }
<span class="lineNum">     420 </span>            :         }
<span class="lineNum">     421 </span>            : 
<span class="lineNum">     422 </span><span class="lineCov">     106701 :         return 0;</span>
<span class="lineNum">     423 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
