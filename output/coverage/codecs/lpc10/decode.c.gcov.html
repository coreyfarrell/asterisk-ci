<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - Asterisk GIT-16-d8ac5bf1a5 - codecs/lpc10/decode.c</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">codecs/lpc10</a> - decode.c<span style="font-size: 80%;"> (source / <a href="decode.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">Asterisk GIT-16-d8ac5bf1a5</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">114</td>
            <td class="headerCovTableEntry">154</td>
            <td class="headerCovTableEntryLo">74.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2018-07-23 21:48:22</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            : 
<span class="lineNum">       3 </span>            : $Log$
<span class="lineNum">       4 </span>            : Revision 1.16  2004/06/26 03:50:14  markster
<span class="lineNum">       5 </span>            : Merge source cleanups (bug #1911)
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            : Revision 1.15  2003/09/19 01:20:22  markster
<span class="lineNum">       8 </span>            : Code cleanups (bug #66)
<span class="lineNum">       9 </span>            : 
<span class="lineNum">      10 </span>            : Revision 1.2  2003/09/19 01:20:22  markster
<span class="lineNum">      11 </span>            : Code cleanups (bug #66)
<span class="lineNum">      12 </span>            : 
<span class="lineNum">      13 </span>            : Revision 1.1.1.1  2003/02/12 13:59:14  matteo
<span class="lineNum">      14 </span>            : mer feb 12 14:56:57 CET 2003
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : Revision 1.2  2000/01/05 08:20:39  markster
<span class="lineNum">      17 </span>            : Some OSS fixes and a few lpc changes to make it actually work
<span class="lineNum">      18 </span>            : 
<span class="lineNum">      19 </span>            :  * Revision 1.2  1996/08/20  20:22:39  jaf
<span class="lineNum">      20 </span>            :  * Removed all static local variables that were SAVE'd in the Fortran
<span class="lineNum">      21 </span>            :  * code, and put them in struct lpc10_decoder_state that is passed as an
<span class="lineNum">      22 </span>            :  * argument.
<span class="lineNum">      23 </span>            :  *
<span class="lineNum">      24 </span>            :  * Removed init function, since all initialization is now done in
<span class="lineNum">      25 </span>            :  * init_lpc10_decoder_state().
<span class="lineNum">      26 </span>            :  *
<span class="lineNum">      27 </span>            :  * Revision 1.1  1996/08/19  22:32:38  jaf
<span class="lineNum">      28 </span>            :  * Initial revision
<span class="lineNum">      29 </span>            :  *
<span class="lineNum">      30 </span>            : 
<span class="lineNum">      31 </span>            : */
<span class="lineNum">      32 </span>            : 
<span class="lineNum">      33 </span>            : /*  -- translated by f2c (version 19951025).
<span class="lineNum">      34 </span>            :    You must link the resulting object file with the libraries:
<span class="lineNum">      35 </span>            :         -lf2c -lm   (in that order)
<span class="lineNum">      36 </span>            : */
<span class="lineNum">      37 </span>            : 
<span class="lineNum">      38 </span>            : #include &quot;f2c.h&quot;
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            : #ifdef P_R_O_T_O_T_Y_P_E_S
<span class="lineNum">      41 </span>            : extern int decode_(integer *ipitv, integer *irms, integer *irc, integer *voice, integer *pitch, real *rms, real *rc, struct lpc10_decoder_state *st);
<span class="lineNum">      42 </span>            : /* comlen contrl_ 12 */
<span class="lineNum">      43 </span>            : /*:ref: ham84_ 14 3 4 4 4 */
<span class="lineNum">      44 </span>            : /*:ref: median_ 4 3 4 4 4 */
<span class="lineNum">      45 </span>            : #endif
<span class="lineNum">      46 </span>            : 
<span class="lineNum">      47 </span>            : /* Common Block Declarations */
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            : extern struct {
<span class="lineNum">      50 </span>            :     integer order, lframe;
<span class="lineNum">      51 </span>            :     logical corrp;
<span class="lineNum">      52 </span>            : } contrl_;
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            : #define contrl_1 contrl_
<span class="lineNum">      55 </span>            : 
<span class="lineNum">      56 </span>            : /* Table of constant values */
<span class="lineNum">      57 </span>            : 
<span class="lineNum">      58 </span>            : static integer c__2 = 2;
<span class="lineNum">      59 </span>            : 
<span class="lineNum">      60 </span>            : /* ***************************************************************** */
<span class="lineNum">      61 </span>            : 
<span class="lineNum">      62 </span>            : /*      DECODE Version 54 */
<span class="lineNum">      63 </span>            : 
<span class="lineNum">      64 </span>            : /* $Log$
<span class="lineNum">      65 </span>            :  * Revision 1.16  2004/06/26 03:50:14  markster
<span class="lineNum">      66 </span>            :  * Merge source cleanups (bug #1911)
<span class="lineNum">      67 </span>            :  *
<span class="lineNum">      68 </span>            :  * Revision 1.15  2003/09/19 01:20:22  markster
<span class="lineNum">      69 </span>            :  * Code cleanups (bug #66)
<span class="lineNum">      70 </span>            :  *
<span class="lineNum">      71 </span>            :  * Revision 1.2  2003/09/19 01:20:22  markster
<span class="lineNum">      72 </span>            :  * Code cleanups (bug #66)
<span class="lineNum">      73 </span>            :  *
<span class="lineNum">      74 </span>            :  * Revision 1.1.1.1  2003/02/12 13:59:14  matteo
<span class="lineNum">      75 </span>            :  * mer feb 12 14:56:57 CET 2003
<span class="lineNum">      76 </span>            :  *
<span class="lineNum">      77 </span>            :  * Revision 1.2  2000/01/05 08:20:39  markster
<span class="lineNum">      78 </span>            :  * Some OSS fixes and a few lpc changes to make it actually work
<span class="lineNum">      79 </span>            :  *
<span class="lineNum">      80 </span>            :  * Revision 1.2  1996/08/20  20:22:39  jaf
<span class="lineNum">      81 </span>            :  * Removed all static local variables that were SAVE'd in the Fortran
<span class="lineNum">      82 </span>            :  * code, and put them in struct lpc10_decoder_state that is passed as an
<span class="lineNum">      83 </span>            :  * argument.
<span class="lineNum">      84 </span>            :  *
<span class="lineNum">      85 </span>            :  * Removed init function, since all initialization is now done in
<span class="lineNum">      86 </span>            :  * init_lpc10_decoder_state().
<span class="lineNum">      87 </span>            :  *
<span class="lineNum">      88 </span>            :  * Revision 1.1  1996/08/19  22:32:38  jaf
<span class="lineNum">      89 </span>            :  * Initial revision
<span class="lineNum">      90 </span>            :  * */
<span class="lineNum">      91 </span>            : /* Revision 1.5  1996/05/23  20:06:03  jaf */
<span class="lineNum">      92 </span>            : /* Assigned PITCH a &quot;default&quot; value on the first call, since otherwise it */
<span class="lineNum">      93 </span>            : /* would be left uninitialized. */
<span class="lineNum">      94 </span>            : 
<span class="lineNum">      95 </span>            : /* Revision 1.4  1996/03/26  19:35:18  jaf */
<span class="lineNum">      96 </span>            : /* Commented out trace statements. */
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            : /* Revision 1.3  1996/03/21  21:10:50  jaf */
<span class="lineNum">      99 </span>            : /* Added entry INITDECODE to reinitialize the local state of subroutine */
<span class="lineNum">     100 </span>            : /* DECODE. */
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span>            : /* Revision 1.2  1996/03/21  21:04:50  jaf */
<span class="lineNum">     103 </span>            : /* Determined which local variables should be saved from one invocation */
<span class="lineNum">     104 </span>            : /* to the next, and guessed initial values for some that should have been */
<span class="lineNum">     105 </span>            : /* saved, but weren't given initial values.  Many of the arrays are */
<span class="lineNum">     106 </span>            : /* &quot;constants&quot;, and many local variables are only used if the &quot;global&quot; */
<span class="lineNum">     107 </span>            : /* variable CORRP is .TRUE. */
<span class="lineNum">     108 </span>            : 
<span class="lineNum">     109 </span>            : /* Added comments explaining which indices of array arguments are read or */
<span class="lineNum">     110 </span>            : /* written. */
<span class="lineNum">     111 </span>            : 
<span class="lineNum">     112 </span>            : /* Revision 1.1  1996/02/12 03:21:10  jaf */
<span class="lineNum">     113 </span>            : /* Initial revision */
<span class="lineNum">     114 </span>            : 
<span class="lineNum">     115 </span>            : 
<span class="lineNum">     116 </span>            : /* ***************************************************************** */
<span class="lineNum">     117 </span>            : 
<span class="lineNum">     118 </span>            : /*   This subroutine provides error correction and decoding */
<span class="lineNum">     119 </span>            : /*   for all LPC parameters */
<span class="lineNum">     120 </span>            : 
<span class="lineNum">     121 </span>            : /* Input: */
<span class="lineNum">     122 </span>            : /*  IPITV  - Index value of pitch */
<span class="lineNum">     123 </span>            : /*  IRMS   - Coded Energy */
<span class="lineNum">     124 </span>            : /*  CORRP  - Error correction: */
<span class="lineNum">     125 </span>            : /*    If FALSE, parameters are decoded directly with no delay.  If TRUE, */
<span class="lineNum">     126 </span>            : /*    most important parameter bits are protected by Hamming code and */
<span class="lineNum">     127 </span>            : /*    median smoothed.  This requires an additional frame of delay. */
<span class="lineNum">     128 </span>            : /* Input/Output: */
<span class="lineNum">     129 </span>            : /*  IRC    - Coded Reflection Coefficients */
<span class="lineNum">     130 </span>            : /*           Indices 1 through ORDER always read, then written. */
<span class="lineNum">     131 </span>            : /* Output: */
<span class="lineNum">     132 </span>            : /*  VOICE  - Half frame voicing decisions */
<span class="lineNum">     133 </span>            : /*           Indices 1 through 2 written. */
<span class="lineNum">     134 </span>            : /*  PITCH  - Decoded pitch */
<span class="lineNum">     135 </span>            : /*  RMS    - Energy */
<span class="lineNum">     136 </span>            : /*  RC     - Reflection coefficients */
<span class="lineNum">     137 </span>            : /*           Indices 1 through ORDER written. */
<span class="lineNum">     138 </span>            : 
<span class="lineNum">     139 </span>            : /*  NOTE: Zero RC's should be done more directly, but this would affect */
<span class="lineNum">     140 </span>            : /*   coded parameter printout. */
<span class="lineNum">     141 </span>            : 
<span class="lineNum">     142 </span>            : /* This subroutine maintains local state from one call to the next.  If */
<span class="lineNum">     143 </span>            : /* you want to switch to using a new audio stream for this filter, or */
<span class="lineNum">     144 </span>            : /* reinitialize its state for any other reason, call the ENTRY */
<a name="145"><span class="lineNum">     145 </span>            : /* INITDECODE. */</a>
<span class="lineNum">     146 </span>            : 
<span class="lineNum">     147 </span><span class="lineCov">      50265 : /* Subroutine */ int decode_(integer *ipitv, integer *irms,</span>
<span class="lineNum">     148 </span>            :         integer *irc, integer *voice, integer *pitch, real *rms, real *rc,
<span class="lineNum">     149 </span>            :                              struct lpc10_decoder_state *st)
<span class="lineNum">     150 </span>            : {
<span class="lineNum">     151 </span>            :     /* Initialized data */
<span class="lineNum">     152 </span>            : 
<span class="lineNum">     153 </span>            :     logical *first;
<span class="lineNum">     154 </span>            :     static integer ethrs = 2048;
<span class="lineNum">     155 </span>            :     static integer ethrs1 = 128;
<span class="lineNum">     156 </span>            :     static integer ethrs2 = 1024;
<span class="lineNum">     157 </span>            :     static integer ethrs3 = 2048;
<span class="lineNum">     158 </span>            :     static integer ivtab[32] = { 24960,24960,24960,24960,25480,25480,25483,
<span class="lineNum">     159 </span>            :             25480,16640,1560,1560,1560,16640,1816,1563,1560,24960,24960,24859,
<span class="lineNum">     160 </span>            :             24856,26001,25881,25915,25913,1560,1560,7800,3640,1561,1561,3643,
<span class="lineNum">     161 </span>            :             3641 };
<span class="lineNum">     162 </span>            :     static real corth[32]       /* was [4][8] */ = { 32767.f,10.f,5.f,0.f,
<span class="lineNum">     163 </span>            :             32767.f,8.f,4.f,0.f,32.f,6.4f,3.2f,0.f,32.f,6.4f,3.2f,0.f,32.f,
<span class="lineNum">     164 </span>            :             11.2f,6.4f,0.f,32.f,11.2f,6.4f,0.f,16.f,5.6f,3.2f,0.f,16.f,5.6f,
<span class="lineNum">     165 </span>            :             3.2f,0.f };
<span class="lineNum">     166 </span>            :     static integer detau[128] = { 0,0,0,3,0,3,3,31,0,3,3,21,3,3,29,30,0,3,3,
<span class="lineNum">     167 </span>            :             20,3,25,27,26,3,23,58,22,3,24,28,3,0,3,3,3,3,39,33,32,3,37,35,36,
<span class="lineNum">     168 </span>            :             3,38,34,3,3,42,46,44,50,40,48,3,54,3,56,3,52,3,3,1,0,3,3,108,3,78,
<span class="lineNum">     169 </span>            :             100,104,3,84,92,88,156,80,96,3,3,74,70,72,66,76,68,3,62,3,60,3,64,
<span class="lineNum">     170 </span>            :             3,3,1,3,116,132,112,148,152,3,3,140,3,136,3,144,3,3,1,124,120,128,
<span class="lineNum">     171 </span>            :             3,3,3,3,1,3,3,3,1,3,1,1,1 };
<span class="lineNum">     172 </span>            :     static integer rmst[64] = { 1024,936,856,784,718,656,600,550,502,460,420,
<span class="lineNum">     173 </span>            :             384,352,328,294,270,246,226,206,188,172,158,144,132,120,110,102,
<span class="lineNum">     174 </span>            :             92,84,78,70,64,60,54,50,46,42,38,34,32,30,26,24,22,20,18,17,16,15,
<span class="lineNum">     175 </span>            :             14,13,12,11,10,9,8,7,6,5,4,3,2,1,0 };
<span class="lineNum">     176 </span>            :     static integer detab7[32] = { 4,11,18,25,32,39,46,53,60,66,72,77,82,87,92,
<span class="lineNum">     177 </span>            :             96,101,104,108,111,114,115,117,119,121,122,123,124,125,126,127,
<span class="lineNum">     178 </span>            :             127 };
<span class="lineNum">     179 </span>            :     static real descl[8] = { .6953f,.625f,.5781f,.5469f,.5312f,.5391f,.4688f,
<span class="lineNum">     180 </span>            :             .3828f };
<span class="lineNum">     181 </span>            :     integer *ivp2h;
<span class="lineNum">     182 </span>            :     static integer deadd[8] = { 1152,-2816,-1536,-3584,-1280,-2432,768,-1920 }
<span class="lineNum">     183 </span>            :             ;
<span class="lineNum">     184 </span>            :     static integer qb[8] = { 511,511,1023,1023,1023,1023,2047,4095 };
<span class="lineNum">     185 </span>            :     static integer nbit[10] = { 8,8,5,5,4,4,4,4,3,2 };
<span class="lineNum">     186 </span>            :     static integer zrc[10] = { 0,0,0,0,0,3,0,2,0,0 };
<span class="lineNum">     187 </span>            :     static integer bit[5] = { 2,4,8,16,32 };
<span class="lineNum">     188 </span>            :     integer *iovoic;
<span class="lineNum">     189 </span>            :     integer *iavgp;
<span class="lineNum">     190 </span>            :     integer *iptold;
<span class="lineNum">     191 </span>            :     integer *erate;
<span class="lineNum">     192 </span>            :     integer *drc;
<span class="lineNum">     193 </span>            :     integer *dpit;
<span class="lineNum">     194 </span>            :     integer *drms;
<span class="lineNum">     195 </span>            : 
<span class="lineNum">     196 </span>            :     /* System generated locals */
<span class="lineNum">     197 </span>            :     integer i__1, i__2;
<span class="lineNum">     198 </span>            : 
<span class="lineNum">     199 </span>            :     /* Builtin functions */
<span class="lineNum">     200 </span>            :     integer pow_ii(integer *, integer *);
<span class="lineNum">     201 </span>            : 
<span class="lineNum">     202 </span>            :     /* Local variables */
<span class="lineNum">     203 </span>            :     extern /* Subroutine */ int ham84_(integer *, integer *, integer *);
<span class="lineNum">     204 </span>            :     integer ipit, iout, i__, icorf, index, ivoic, ixcor, i1, i2, i4;
<span class="lineNum">     205 </span>            :     extern integer median_(integer *, integer *, integer *);
<span class="lineNum">     206 </span>            :     integer ishift, errcnt, lsb;
<span class="lineNum">     207 </span>            : 
<span class="lineNum">     208 </span>            : /* $Log$
<span class="lineNum">     209 </span>            :  * Revision 1.16  2004/06/26 03:50:14  markster
<span class="lineNum">     210 </span>            :  * Merge source cleanups (bug #1911)
<span class="lineNum">     211 </span>            :  *
<span class="lineNum">     212 </span>            :  * Revision 1.15  2003/09/19 01:20:22  markster
<span class="lineNum">     213 </span>            :  * Code cleanups (bug #66)
<span class="lineNum">     214 </span>            :  *
<span class="lineNum">     215 </span>            :  * Revision 1.2  2003/09/19 01:20:22  markster
<span class="lineNum">     216 </span>            :  * Code cleanups (bug #66)
<span class="lineNum">     217 </span>            :  *
<span class="lineNum">     218 </span>            :  * Revision 1.1.1.1  2003/02/12 13:59:14  matteo
<span class="lineNum">     219 </span>            :  * mer feb 12 14:56:57 CET 2003
<span class="lineNum">     220 </span>            :  *
<span class="lineNum">     221 </span>            :  * Revision 1.2  2000/01/05 08:20:39  markster
<span class="lineNum">     222 </span>            :  * Some OSS fixes and a few lpc changes to make it actually work
<span class="lineNum">     223 </span>            :  *
<span class="lineNum">     224 </span>            :  * Revision 1.2  1996/08/20  20:22:39  jaf
<span class="lineNum">     225 </span>            :  * Removed all static local variables that were SAVE'd in the Fortran
<span class="lineNum">     226 </span>            :  * code, and put them in struct lpc10_decoder_state that is passed as an
<span class="lineNum">     227 </span>            :  * argument.
<span class="lineNum">     228 </span>            :  *
<span class="lineNum">     229 </span>            :  * Removed init function, since all initialization is now done in
<span class="lineNum">     230 </span>            :  * init_lpc10_decoder_state().
<span class="lineNum">     231 </span>            :  *
<span class="lineNum">     232 </span>            :  * Revision 1.1  1996/08/19  22:32:38  jaf
<span class="lineNum">     233 </span>            :  * Initial revision
<span class="lineNum">     234 </span>            :  * */
<span class="lineNum">     235 </span>            : /* Revision 1.3  1996/03/29  22:03:47  jaf */
<span class="lineNum">     236 </span>            : /* Removed definitions for any constants that were no longer used. */
<span class="lineNum">     237 </span>            : 
<span class="lineNum">     238 </span>            : /* Revision 1.2  1996/03/26  19:34:33  jaf */
<span class="lineNum">     239 </span>            : /* Added comments indicating which constants are not needed in an */
<span class="lineNum">     240 </span>            : /* application that uses the LPC-10 coder. */
<span class="lineNum">     241 </span>            : 
<span class="lineNum">     242 </span>            : /* Revision 1.1  1996/02/07  14:43:51  jaf */
<span class="lineNum">     243 </span>            : /* Initial revision */
<span class="lineNum">     244 </span>            : 
<span class="lineNum">     245 </span>            : /*   LPC Configuration parameters: */
<span class="lineNum">     246 </span>            : /* Frame size, Prediction order, Pitch period */
<span class="lineNum">     247 </span>            : /*       Arguments */
<span class="lineNum">     248 </span>            : /* $Log$
<span class="lineNum">     249 </span>            :  * Revision 1.16  2004/06/26 03:50:14  markster
<span class="lineNum">     250 </span>            :  * Merge source cleanups (bug #1911)
<span class="lineNum">     251 </span>            :  *
<span class="lineNum">     252 </span>            :  * Revision 1.15  2003/09/19 01:20:22  markster
<span class="lineNum">     253 </span>            :  * Code cleanups (bug #66)
<span class="lineNum">     254 </span>            :  *
<span class="lineNum">     255 </span>            :  * Revision 1.2  2003/09/19 01:20:22  markster
<span class="lineNum">     256 </span>            :  * Code cleanups (bug #66)
<span class="lineNum">     257 </span>            :  *
<span class="lineNum">     258 </span>            :  * Revision 1.1.1.1  2003/02/12 13:59:14  matteo
<span class="lineNum">     259 </span>            :  * mer feb 12 14:56:57 CET 2003
<span class="lineNum">     260 </span>            :  *
<span class="lineNum">     261 </span>            :  * Revision 1.2  2000/01/05 08:20:39  markster
<span class="lineNum">     262 </span>            :  * Some OSS fixes and a few lpc changes to make it actually work
<span class="lineNum">     263 </span>            :  *
<span class="lineNum">     264 </span>            :  * Revision 1.2  1996/08/20  20:22:39  jaf
<span class="lineNum">     265 </span>            :  * Removed all static local variables that were SAVE'd in the Fortran
<span class="lineNum">     266 </span>            :  * code, and put them in struct lpc10_decoder_state that is passed as an
<span class="lineNum">     267 </span>            :  * argument.
<span class="lineNum">     268 </span>            :  *
<span class="lineNum">     269 </span>            :  * Removed init function, since all initialization is now done in
<span class="lineNum">     270 </span>            :  * init_lpc10_decoder_state().
<span class="lineNum">     271 </span>            :  *
<span class="lineNum">     272 </span>            :  * Revision 1.1  1996/08/19  22:32:38  jaf
<span class="lineNum">     273 </span>            :  * Initial revision
<span class="lineNum">     274 </span>            :  * */
<span class="lineNum">     275 </span>            : /* Revision 1.3  1996/03/29  22:05:55  jaf */
<span class="lineNum">     276 </span>            : /* Commented out the common block variables that are not needed by the */
<span class="lineNum">     277 </span>            : /* embedded version. */
<span class="lineNum">     278 </span>            : 
<span class="lineNum">     279 </span>            : /* Revision 1.2  1996/03/26  19:34:50  jaf */
<span class="lineNum">     280 </span>            : /* Added comments indicating which constants are not needed in an */
<span class="lineNum">     281 </span>            : /* application that uses the LPC-10 coder. */
<span class="lineNum">     282 </span>            : 
<span class="lineNum">     283 </span>            : /* Revision 1.1  1996/02/07  14:44:09  jaf */
<span class="lineNum">     284 </span>            : /* Initial revision */
<span class="lineNum">     285 </span>            : 
<span class="lineNum">     286 </span>            : /*   LPC Processing control variables: */
<span class="lineNum">     287 </span>            : 
<span class="lineNum">     288 </span>            : /* *** Read-only: initialized in setup */
<span class="lineNum">     289 </span>            : 
<span class="lineNum">     290 </span>            : /*  Files for Speech, Parameter, and Bitstream Input &amp; Output, */
<span class="lineNum">     291 </span>            : /*    and message and debug outputs. */
<span class="lineNum">     292 </span>            : 
<span class="lineNum">     293 </span>            : /* Here are the only files which use these variables: */
<span class="lineNum">     294 </span>            : 
<span class="lineNum">     295 </span>            : /* lpcsim.f setup.f trans.f error.f vqsetup.f */
<span class="lineNum">     296 </span>            : 
<span class="lineNum">     297 </span>            : /* Many files which use fdebug are not listed, since it is only used in */
<span class="lineNum">     298 </span>            : /* those other files conditionally, to print trace statements. */
<span class="lineNum">     299 </span>            : /*      integer fsi, fso, fpi, fpo, fbi, fbo, pbin, fmsg, fdebug */
<span class="lineNum">     300 </span>            : /*  LPC order, Frame size, Quantization rate, Bits per frame, */
<span class="lineNum">     301 </span>            : /*    Error correction */
<span class="lineNum">     302 </span>            : /* Subroutine SETUP is the only place where order is assigned a value, */
<span class="lineNum">     303 </span>            : /* and that value is 10.  It could increase efficiency 1% or so to */
<span class="lineNum">     304 </span>            : /* declare order as a constant (i.e., a Fortran PARAMETER) instead of as
<span class="lineNum">     305 </span>            : */
<span class="lineNum">     306 </span>            : /* a variable in a COMMON block, since it is used in many places in the */
<span class="lineNum">     307 </span>            : /* core of the coding and decoding routines.  Actually, I take that back.
<span class="lineNum">     308 </span>            : */
<span class="lineNum">     309 </span>            : /* At least when compiling with f2c, the upper bound of DO loops is */
<span class="lineNum">     310 </span>            : /* stored in a local variable before the DO loop begins, and then that is
<span class="lineNum">     311 </span>            : */
<span class="lineNum">     312 </span>            : /* compared against on each iteration. */
<span class="lineNum">     313 </span>            : /* Similarly for lframe, which is given a value of MAXFRM in SETUP. */
<span class="lineNum">     314 </span>            : /* Similarly for quant, which is given a value of 2400 in SETUP.  quant */
<span class="lineNum">     315 </span>            : /* is used in only a few places, and never in the core coding and */
<span class="lineNum">     316 </span>            : /* decoding routines, so it could be eliminated entirely. */
<span class="lineNum">     317 </span>            : /* nbits is similar to quant, and is given a value of 54 in SETUP. */
<span class="lineNum">     318 </span>            : /* corrp is given a value of .TRUE. in SETUP, and is only used in the */
<span class="lineNum">     319 </span>            : /* subroutines ENCODE and DECODE.  It doesn't affect the speed of the */
<span class="lineNum">     320 </span>            : /* coder significantly whether it is .TRUE. or .FALSE., or whether it is
<span class="lineNum">     321 </span>            : */
<span class="lineNum">     322 </span>            : /* a constant or a variable, since it is only examined once per frame. */
<span class="lineNum">     323 </span>            : /* Leaving it as a variable that is set to .TRUE.  seems like a good */
<span class="lineNum">     324 </span>            : /* idea, since it does enable some error-correction capability for */
<span class="lineNum">     325 </span>            : /* unvoiced frames, with no change in the coding rate, and no noticeable
<span class="lineNum">     326 </span>            : */
<span class="lineNum">     327 </span>            : /* quality difference in the decoded speech. */
<span class="lineNum">     328 </span>            : /*      integer quant, nbits */
<span class="lineNum">     329 </span>            : /* *** Read/write: variables for debugging, not needed for LPC algorithm
<span class="lineNum">     330 </span>            : */
<span class="lineNum">     331 </span>            : 
<span class="lineNum">     332 </span>            : /*  Current frame, Unstable frames, Output clip count, Max onset buffer,
<span class="lineNum">     333 </span>            : */
<span class="lineNum">     334 </span>            : /*    Debug listing detail level, Line count on listing page */
<span class="lineNum">     335 </span>            : 
<span class="lineNum">     336 </span>            : /* nframe is not needed for an embedded LPC10 at all. */
<span class="lineNum">     337 </span>            : /* nunsfm is initialized to 0 in SETUP, and incremented in subroutine */
<span class="lineNum">     338 </span>            : /* ERROR, which is only called from RCCHK.  When LPC10 is embedded into */
<span class="lineNum">     339 </span>            : /* an application, I would recommend removing the call to ERROR in RCCHK,
<span class="lineNum">     340 </span>            : */
<span class="lineNum">     341 </span>            : /* and remove ERROR and nunsfm completely. */
<span class="lineNum">     342 </span>            : /* iclip is initialized to 0 in SETUP, and incremented in entry SWRITE in
<span class="lineNum">     343 </span>            : */
<span class="lineNum">     344 </span>            : /* sread.f.  When LPC10 is embedded into an application, one might want */
<span class="lineNum">     345 </span>            : /* to cause it to be incremented in a routine that takes the output of */
<span class="lineNum">     346 </span>            : /* SYNTHS and sends it to an audio device.  It could be optionally */
<span class="lineNum">     347 </span>            : /* displayed, for those that might want to know what it is. */
<span class="lineNum">     348 </span>            : /* maxosp is never initialized to 0 in SETUP, although it probably should
<span class="lineNum">     349 </span>            : */
<span class="lineNum">     350 </span>            : /* be, and it is updated in subroutine ANALYS.  I doubt that its value */
<span class="lineNum">     351 </span>            : /* would be of much interest to an application in which LPC10 is */
<span class="lineNum">     352 </span>            : /* embedded. */
<span class="lineNum">     353 </span>            : /* listl and lincnt are not needed for an embedded LPC10 at all. */
<span class="lineNum">     354 </span>            : /*      integer nframe, nunsfm, iclip, maxosp, listl, lincnt */
<span class="lineNum">     355 </span>            : /*      common /contrl/ fsi, fso, fpi, fpo, fbi, fbo, pbin, fmsg, fdebug */
<span class="lineNum">     356 </span>            : /*      common /contrl/ quant, nbits */
<span class="lineNum">     357 </span>            : /*      common /contrl/ nframe, nunsfm, iclip, maxosp, listl, lincnt */
<span class="lineNum">     358 </span>            : /*       Function return value definitions */
<span class="lineNum">     359 </span>            : 
<span class="lineNum">     360 </span>            : /*       Parameters/constants */
<span class="lineNum">     361 </span>            : 
<span class="lineNum">     362 </span>            : /*       The variables below that are not Fortran PARAMETER's are */
<span class="lineNum">     363 </span>            : /*       initialized with DATA statements, and then never modified. */
<span class="lineNum">     364 </span>            : /*       The following are used regardless of CORRP's value. */
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span>            : /*       DETAU, NBIT, QB, DEADD, DETAB7, RMST, DESCL */
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span>            : /*       The following are used only if CORRP is .TRUE. */
<span class="lineNum">     369 </span>            : 
<span class="lineNum">     370 </span>            : /*       ETHRS, ETHRS1, ETHRS2, ETHRS3, IVTAB, BIT, CORTH, ZRC */
<span class="lineNum">     371 </span>            : 
<span class="lineNum">     372 </span>            : /*       Local variables that need not be saved */
<span class="lineNum">     373 </span>            : 
<span class="lineNum">     374 </span>            : /*       The following are used regardless of CORRP's value */
<span class="lineNum">     375 </span>            : /*       The following are used only if CORRP is .TRUE. */
<span class="lineNum">     376 </span>            : 
<span class="lineNum">     377 </span>            : /*       Local state */
<span class="lineNum">     378 </span>            : 
<span class="lineNum">     379 </span>            : /*       The following are used regardless of CORRP's value */
<span class="lineNum">     380 </span>            : /*       The following are used only if CORRP is .TRUE. */
<span class="lineNum">     381 </span>            : /*       I am guessing the initial values for IVP2H, IOVOIC, DRC, DPIT, */
<span class="lineNum">     382 </span>            : /*       and DRMS.  They should be checked to see if they are reasonable.
<span class="lineNum">     383 </span>            : */
<span class="lineNum">     384 </span>            : /*       I'm also guessing for ERATE, but I think 0 is the right initial
<span class="lineNum">     385 </span>            : */
<span class="lineNum">     386 </span>            : /*       value. */
<span class="lineNum">     387 </span>            :     /* Parameter adjustments */
<span class="lineNum">     388 </span><span class="lineCov">      50265 :     if (irc) {</span>
<span class="lineNum">     389 </span><span class="lineCov">      50265 :         --irc;</span>
<span class="lineNum">     390 </span>            :         }
<span class="lineNum">     391 </span><span class="lineCov">      50265 :     if (voice) {</span>
<span class="lineNum">     392 </span><span class="lineCov">      50265 :         --voice;</span>
<span class="lineNum">     393 </span>            :         }
<span class="lineNum">     394 </span><span class="lineCov">      50265 :     if (rc) {</span>
<span class="lineNum">     395 </span><span class="lineCov">      50265 :         --rc;</span>
<span class="lineNum">     396 </span>            :         }
<span class="lineNum">     397 </span>            : 
<span class="lineNum">     398 </span>            :     /* Function Body */
<span class="lineNum">     399 </span>            : 
<span class="lineNum">     400 </span><span class="lineCov">      50265 :     iptold = &amp;(st-&gt;iptold);</span>
<span class="lineNum">     401 </span><span class="lineCov">      50265 :     first = &amp;(st-&gt;first);</span>
<span class="lineNum">     402 </span><span class="lineCov">      50265 :     ivp2h = &amp;(st-&gt;ivp2h);</span>
<span class="lineNum">     403 </span><span class="lineCov">      50265 :     iovoic = &amp;(st-&gt;iovoic);</span>
<span class="lineNum">     404 </span><span class="lineCov">      50265 :     iavgp = &amp;(st-&gt;iavgp);</span>
<span class="lineNum">     405 </span><span class="lineCov">      50265 :     erate = &amp;(st-&gt;erate);</span>
<span class="lineNum">     406 </span><span class="lineCov">      50265 :     drc = &amp;(st-&gt;drc[0]);</span>
<span class="lineNum">     407 </span><span class="lineCov">      50265 :     dpit = &amp;(st-&gt;dpit[0]);</span>
<span class="lineNum">     408 </span><span class="lineCov">      50265 :     drms = &amp;(st-&gt;drms[0]);</span>
<span class="lineNum">     409 </span>            : 
<span class="lineNum">     410 </span>            : /* DATA statements for &quot;constants&quot; defined above. */
<span class="lineNum">     411 </span>            : /*      IF (LISTL.GE.3) WRITE(FDEBUG,800) IPITV,IRMS,(IRC(J),J=1,ORDER) */
<span class="lineNum">     412 </span>            : /* 800  FORMAT(1X,' &lt;&lt;ERRCOR IN&gt;&gt;',T32,6X,I6,I5,T50,10I8) */
<span class="lineNum">     413 </span>            : /*  If no error correction, do pitch and voicing then jump to decode */
<span class="lineNum">     414 </span><span class="lineCov">      50265 :     i4 = detau[*ipitv];</span>
<span class="lineNum">     415 </span><span class="lineCov">      50265 :     if (! contrl_1.corrp) {</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :         voice[1] = 1;</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :         voice[2] = 1;</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :         if (*ipitv &lt;= 1) {</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :             voice[1] = 0;</span>
<span class="lineNum">     420 </span>            :         }
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :         if (*ipitv == 0 || *ipitv == 2) {</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :             voice[2] = 0;</span>
<span class="lineNum">     423 </span>            :         }
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :         *pitch = i4;</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :         if (*pitch &lt;= 4) {</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :             *pitch = *iptold;</span>
<span class="lineNum">     427 </span>            :         }
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :         if (voice[1] == 1 &amp;&amp; voice[2] == 1) {</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :             *iptold = *pitch;</span>
<span class="lineNum">     430 </span>            :         }
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :         if (voice[1] != voice[2]) {</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :             *pitch = *iptold;</span>
<span class="lineNum">     433 </span>            :         }
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :         goto L900;</span>
<span class="lineNum">     435 </span>            :     }
<span class="lineNum">     436 </span>            : /*  Do error correction pitch and voicing */
<span class="lineNum">     437 </span><span class="lineCov">      50265 :     if (i4 &gt; 4) {</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :         dpit[0] = i4;</span>
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :         ivoic = 2;</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :         *iavgp = (*iavgp * 15 + i4 + 8) / 16;</span>
<span class="lineNum">     441 </span>            :     } else {
<span class="lineNum">     442 </span><span class="lineCov">      50265 :         ivoic = i4;</span>
<span class="lineNum">     443 </span><span class="lineCov">      50265 :         dpit[0] = *iavgp;</span>
<span class="lineNum">     444 </span>            :     }
<span class="lineNum">     445 </span><span class="lineCov">      50265 :     drms[0] = *irms;</span>
<span class="lineNum">     446 </span><span class="lineCov">      50265 :     i__1 = contrl_1.order;</span>
<span class="lineNum">     447 </span><span class="lineCov">     552915 :     for (i__ = 1; i__ &lt;= i__1; ++i__) {</span>
<span class="lineNum">     448 </span><span class="lineCov">     502650 :         drc[i__ * 3 - 3] = irc[i__];</span>
<span class="lineNum">     449 </span>            :     }
<span class="lineNum">     450 </span>            : /*  Determine index to IVTAB from V/UV decision */
<span class="lineNum">     451 </span>            : /*  If error rate is high then use alternate table */
<span class="lineNum">     452 </span><span class="lineCov">      50265 :     index = (*ivp2h &lt;&lt; 4) + (*iovoic &lt;&lt; 2) + ivoic + 1;</span>
<span class="lineNum">     453 </span><span class="lineCov">      50265 :     i1 = ivtab[index - 1];</span>
<span class="lineNum">     454 </span><span class="lineCov">      50265 :     ipit = i1 &amp; 3;</span>
<span class="lineNum">     455 </span><span class="lineCov">      50265 :     icorf = i1 / 8;</span>
<span class="lineNum">     456 </span><span class="lineCov">      50265 :     if (*erate &lt; ethrs) {</span>
<span class="lineNum">     457 </span><span class="lineCov">      50265 :         icorf /= 64;</span>
<span class="lineNum">     458 </span>            :     }
<span class="lineNum">     459 </span>            : /*  Determine error rate:  4=high    1=low */
<span class="lineNum">     460 </span><span class="lineCov">      50265 :     ixcor = 4;</span>
<span class="lineNum">     461 </span><span class="lineCov">      50265 :     if (*erate &lt; ethrs3) {</span>
<span class="lineNum">     462 </span><span class="lineCov">      50265 :         ixcor = 3;</span>
<span class="lineNum">     463 </span>            :     }
<span class="lineNum">     464 </span><span class="lineCov">      50265 :     if (*erate &lt; ethrs2) {</span>
<span class="lineNum">     465 </span><span class="lineCov">      50265 :         ixcor = 2;</span>
<span class="lineNum">     466 </span>            :     }
<span class="lineNum">     467 </span><span class="lineCov">      50265 :     if (*erate &lt; ethrs1) {</span>
<span class="lineNum">     468 </span><span class="lineCov">      50265 :         ixcor = 1;</span>
<span class="lineNum">     469 </span>            :     }
<span class="lineNum">     470 </span>            : /*  Voice/unvoice decision determined from bits 0 and 1 of IVTAB */
<span class="lineNum">     471 </span><span class="lineCov">      50265 :     voice[1] = icorf / 2 &amp; 1;</span>
<span class="lineNum">     472 </span><span class="lineCov">      50265 :     voice[2] = icorf &amp; 1;</span>
<span class="lineNum">     473 </span>            : /*  Skip decoding on first frame because present data not yet available */
<span class="lineNum">     474 </span><span class="lineCov">      50265 :     if (*first) {</span>
<span class="lineNum">     475 </span><span class="lineCov">       1117 :         *first = FALSE_;</span>
<span class="lineNum">     476 </span>            : /*          Assign PITCH a &quot;default&quot; value on the first call, since */
<span class="lineNum">     477 </span>            : /*          otherwise it would be left uninitialized.  The two lines
<span class="lineNum">     478 </span>            : */
<span class="lineNum">     479 </span>            : /*          below were copied from above, since it seemed like a */
<span class="lineNum">     480 </span>            : /*          reasonable thing to do for the first call. */
<span class="lineNum">     481 </span><span class="lineCov">       1117 :         *pitch = i4;</span>
<span class="lineNum">     482 </span><span class="lineCov">       1117 :         if (*pitch &lt;= 4) {</span>
<span class="lineNum">     483 </span><span class="lineCov">       1117 :             *pitch = *iptold;</span>
<span class="lineNum">     484 </span>            :         }
<span class="lineNum">     485 </span><span class="lineCov">       1117 :         goto L500;</span>
<span class="lineNum">     486 </span>            :     }
<span class="lineNum">     487 </span>            : /*  If bit 4 of ICORF is set then correct RMS and RC(1) - RC(4). */
<span class="lineNum">     488 </span>            : /*    Determine error rate and correct errors using a Hamming 8,4 code */
<span class="lineNum">     489 </span>            : /*    during transition or unvoiced frame.  If IOUT is negative, */
<span class="lineNum">     490 </span>            : /*    more than 1 error occurred, use previous frame's parameters. */
<span class="lineNum">     491 </span><span class="lineCov">      49148 :     if ((icorf &amp; bit[3]) != 0) {</span>
<span class="lineNum">     492 </span><span class="lineCov">      49148 :         errcnt = 0;</span>
<span class="lineNum">     493 </span><span class="lineCov">      49148 :         lsb = drms[1] &amp; 1;</span>
<span class="lineNum">     494 </span><span class="lineCov">      49148 :         index = (drc[22] &lt;&lt; 4) + drms[1] / 2;</span>
<span class="lineNum">     495 </span><span class="lineCov">      49148 :         ham84_(&amp;index, &amp;iout, &amp;errcnt);</span>
<span class="lineNum">     496 </span><span class="lineCov">      49148 :         drms[1] = drms[2];</span>
<span class="lineNum">     497 </span><span class="lineCov">      49148 :         if (iout &gt;= 0) {</span>
<span class="lineNum">     498 </span><span class="lineCov">      49148 :             drms[1] = (iout &lt;&lt; 1) + lsb;</span>
<span class="lineNum">     499 </span>            :         }
<span class="lineNum">     500 </span><span class="lineCov">     245740 :         for (i__ = 1; i__ &lt;= 4; ++i__) {</span>
<span class="lineNum">     501 </span><span class="lineCov">     196592 :             if (i__ == 1) {</span>
<span class="lineNum">     502 </span><span class="lineCov">      49148 :                 i1 = ((drc[25] &amp; 7) &lt;&lt; 1) + (drc[28] &amp; 1);</span>
<span class="lineNum">     503 </span>            :             } else {
<span class="lineNum">     504 </span><span class="lineCov">     147444 :                 i1 = drc[(9 - i__) * 3 - 2] &amp; 15;</span>
<span class="lineNum">     505 </span>            :             }
<span class="lineNum">     506 </span><span class="lineCov">     196592 :             i2 = drc[(5 - i__) * 3 - 2] &amp; 31;</span>
<span class="lineNum">     507 </span><span class="lineCov">     196592 :             lsb = i2 &amp; 1;</span>
<span class="lineNum">     508 </span><span class="lineCov">     196592 :             index = (i1 &lt;&lt; 4) + i2 / 2;</span>
<span class="lineNum">     509 </span><span class="lineCov">     196592 :             ham84_(&amp;index, &amp;iout, &amp;errcnt);</span>
<span class="lineNum">     510 </span><span class="lineCov">     196592 :             if (iout &gt;= 0) {</span>
<span class="lineNum">     511 </span><span class="lineCov">     196592 :                 iout = (iout &lt;&lt; 1) + lsb;</span>
<span class="lineNum">     512 </span><span class="lineCov">     196592 :                 if ((iout &amp; 16) == 16) {</span>
<span class="lineNum">     513 </span><span class="lineCov">      49148 :                     iout += -32;</span>
<span class="lineNum">     514 </span>            :                 }
<span class="lineNum">     515 </span>            :             } else {
<span class="lineNum">     516 </span><span class="lineNoCov">          0 :                 iout = drc[(5 - i__) * 3 - 1];</span>
<span class="lineNum">     517 </span>            :             }
<span class="lineNum">     518 </span><span class="lineCov">     196592 :             drc[(5 - i__) * 3 - 2] = iout;</span>
<span class="lineNum">     519 </span>            :         }
<span class="lineNum">     520 </span>            : /*  Determine error rate */
<span class="lineNum">     521 </span><span class="lineCov">      49148 :         *erate = (integer)(*erate * .96875f + errcnt * 102);</span>
<span class="lineNum">     522 </span>            :     }
<span class="lineNum">     523 </span>            : /*  Get unsmoothed RMS, RC's, and PITCH */
<span class="lineNum">     524 </span><span class="lineCov">      49148 :     *irms = drms[1];</span>
<span class="lineNum">     525 </span><span class="lineCov">      49148 :     i__1 = contrl_1.order;</span>
<span class="lineNum">     526 </span><span class="lineCov">     540628 :     for (i__ = 1; i__ &lt;= i__1; ++i__) {</span>
<span class="lineNum">     527 </span><span class="lineCov">     491480 :         irc[i__] = drc[i__ * 3 - 2];</span>
<span class="lineNum">     528 </span>            :     }
<span class="lineNum">     529 </span><span class="lineCov">      49148 :     if (ipit == 1) {</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :         dpit[1] = dpit[2];</span>
<span class="lineNum">     531 </span>            :     }
<span class="lineNum">     532 </span><span class="lineCov">      49148 :     if (ipit == 3) {</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :         dpit[1] = dpit[0];</span>
<span class="lineNum">     534 </span>            :     }
<span class="lineNum">     535 </span><span class="lineCov">      49148 :     *pitch = dpit[1];</span>
<span class="lineNum">     536 </span>            : /*  If bit 2 of ICORF is set then smooth RMS and RC's, */
<span class="lineNum">     537 </span><span class="lineCov">      49148 :     if ((icorf &amp; bit[1]) != 0) {</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :         if ((i__1 = drms[1] - drms[0], (real) abs(i__1)) &gt;= corth[ixcor + 3]</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :                 &amp;&amp; (i__2 = drms[1] - drms[2], (real) abs(i__2)) &gt;= corth[</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :                 ixcor + 3]) {</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :             *irms = median_(&amp;drms[2], &amp;drms[1], drms);</span>
<span class="lineNum">     542 </span>            :         }
<span class="lineNum">     543 </span><span class="lineNoCov">          0 :         for (i__ = 1; i__ &lt;= 6; ++i__) {</span>
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :             if ((i__1 = drc[i__ * 3 - 2] - drc[i__ * 3 - 3], (real) abs(i__1))</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :                      &gt;= corth[ixcor + ((i__ + 2) &lt;&lt; 2) - 5] &amp;&amp; (i__2 = drc[i__ *</span>
<span class="lineNum">     546 </span><span class="lineNoCov">          0 :                      3 - 2] - drc[i__ * 3 - 1], (real) abs(i__2)) &gt;= corth[</span>
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :                     ixcor + ((i__ + 2) &lt;&lt; 2) - 5]) {</span>
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :                 irc[i__] = median_(&amp;drc[i__ * 3 - 1], &amp;drc[i__ * 3 - 2], &amp;drc[</span>
<span class="lineNum">     549 </span><span class="lineNoCov">          0 :                         i__ * 3 - 3]);</span>
<span class="lineNum">     550 </span>            :             }
<span class="lineNum">     551 </span>            :         }
<span class="lineNum">     552 </span>            :     }
<span class="lineNum">     553 </span>            : /*  If bit 3 of ICORF is set then smooth pitch */
<span class="lineNum">     554 </span><span class="lineCov">      49148 :     if ((icorf &amp; bit[2]) != 0) {</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :         if ((i__1 = dpit[1] - dpit[0], (real) abs(i__1)) &gt;= corth[ixcor - 1]</span>
<span class="lineNum">     556 </span><span class="lineNoCov">          0 :                 &amp;&amp; (i__2 = dpit[1] - dpit[2], (real) abs(i__2)) &gt;= corth[</span>
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :                 ixcor - 1]) {</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :             *pitch = median_(&amp;dpit[2], &amp;dpit[1], dpit);</span>
<span class="lineNum">     559 </span>            :         }
<span class="lineNum">     560 </span>            :     }
<span class="lineNum">     561 </span>            : /*  If bit 5 of ICORF is set then RC(5) - RC(10) are loaded with */
<span class="lineNum">     562 </span>            : /*  values so that after quantization bias is removed in decode */
<span class="lineNum">     563 </span>            : /*  the values will be zero. */
<span class="lineNum">     564 </span><span class="lineCov">      49148 : L500:</span>
<span class="lineNum">     565 </span><span class="lineCov">      50265 :     if ((icorf &amp; bit[4]) != 0) {</span>
<span class="lineNum">     566 </span><span class="lineCov">      50265 :         i__1 = contrl_1.order;</span>
<span class="lineNum">     567 </span><span class="lineCov">     351855 :         for (i__ = 5; i__ &lt;= i__1; ++i__) {</span>
<span class="lineNum">     568 </span><span class="lineCov">     301590 :             irc[i__] = zrc[i__ - 1];</span>
<span class="lineNum">     569 </span>            :         }
<span class="lineNum">     570 </span>            :     }
<span class="lineNum">     571 </span>            : /*  House keeping  - one frame delay */
<span class="lineNum">     572 </span><span class="lineCov">      50265 :     *iovoic = ivoic;</span>
<span class="lineNum">     573 </span><span class="lineCov">      50265 :     *ivp2h = voice[2];</span>
<span class="lineNum">     574 </span><span class="lineCov">      50265 :     dpit[2] = dpit[1];</span>
<span class="lineNum">     575 </span><span class="lineCov">      50265 :     dpit[1] = dpit[0];</span>
<span class="lineNum">     576 </span><span class="lineCov">      50265 :     drms[2] = drms[1];</span>
<span class="lineNum">     577 </span><span class="lineCov">      50265 :     drms[1] = drms[0];</span>
<span class="lineNum">     578 </span><span class="lineCov">      50265 :     i__1 = contrl_1.order;</span>
<span class="lineNum">     579 </span><span class="lineCov">     552915 :     for (i__ = 1; i__ &lt;= i__1; ++i__) {</span>
<span class="lineNum">     580 </span><span class="lineCov">     502650 :         drc[i__ * 3 - 1] = drc[i__ * 3 - 2];</span>
<span class="lineNum">     581 </span><span class="lineCov">     502650 :         drc[i__ * 3 - 2] = drc[i__ * 3 - 3];</span>
<span class="lineNum">     582 </span>            :     }
<span class="lineNum">     583 </span><span class="lineCov">      50265 : L900:</span>
<span class="lineNum">     584 </span>            : /*      IF (LISTL.GE.3)WRITE(FDEBUG,801)VOICE,PITCH,IRMS,(IRC(J),J=1,ORDER) */
<span class="lineNum">     585 </span>            : /* 801  FORMAT(1X,'&lt;&lt;ERRCOR OUT&gt;&gt;',T32,2I3,I6,I5,T50,10I8) */
<span class="lineNum">     586 </span>            : /*   Decode RMS */
<span class="lineNum">     587 </span><span class="lineCov">      50265 :     *irms = rmst[(31 - *irms) * 2];</span>
<span class="lineNum">     588 </span>            : /*  Decode RC(1) and RC(2) from log-area-ratios */
<span class="lineNum">     589 </span>            : /*  Protect from illegal coded value (-16) caused by bit errors */
<span class="lineNum">     590 </span><span class="lineCov">     150795 :     for (i__ = 1; i__ &lt;= 2; ++i__) {</span>
<span class="lineNum">     591 </span><span class="lineCov">     100530 :         i2 = irc[i__];</span>
<span class="lineNum">     592 </span><span class="lineCov">     100530 :         i1 = 0;</span>
<span class="lineNum">     593 </span><span class="lineCov">     100530 :         if (i2 &lt; 0) {</span>
<span class="lineNum">     594 </span><span class="lineNoCov">          0 :             i1 = 1;</span>
<span class="lineNum">     595 </span><span class="lineNoCov">          0 :             i2 = -i2;</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :             if (i2 &gt; 15) {</span>
<span class="lineNum">     597 </span><span class="lineNoCov">          0 :                 i2 = 0;</span>
<span class="lineNum">     598 </span>            :             }
<span class="lineNum">     599 </span>            :         }
<span class="lineNum">     600 </span><span class="lineCov">     100530 :         i2 = detab7[i2 * 2];</span>
<span class="lineNum">     601 </span><span class="lineCov">     100530 :         if (i1 == 1) {</span>
<span class="lineNum">     602 </span><span class="lineNoCov">          0 :             i2 = -i2;</span>
<span class="lineNum">     603 </span>            :         }
<span class="lineNum">     604 </span><span class="lineCov">     100530 :         ishift = 15 - nbit[i__ - 1];</span>
<span class="lineNum">     605 </span><span class="lineCov">     100530 :         irc[i__] = i2 * pow_ii(&amp;c__2, &amp;ishift);</span>
<span class="lineNum">     606 </span>            :     }
<span class="lineNum">     607 </span>            : /*  Decode RC(3)-RC(10) to sign plus 14 bits */
<span class="lineNum">     608 </span><span class="lineCov">      50265 :     i__1 = contrl_1.order;</span>
<span class="lineNum">     609 </span><span class="lineCov">     452385 :     for (i__ = 3; i__ &lt;= i__1; ++i__) {</span>
<span class="lineNum">     610 </span><span class="lineCov">     402120 :         i2 = irc[i__];</span>
<span class="lineNum">     611 </span><span class="lineCov">     402120 :         ishift = 15 - nbit[i__ - 1];</span>
<span class="lineNum">     612 </span><span class="lineCov">     402120 :         i2 *= pow_ii(&amp;c__2, &amp;ishift);</span>
<span class="lineNum">     613 </span><span class="lineCov">     402120 :         i2 += qb[i__ - 3];</span>
<span class="lineNum">     614 </span><span class="lineCov">     402120 :         irc[i__] = (integer)(i2 * descl[i__ - 3] + deadd[i__ - 3]);</span>
<span class="lineNum">     615 </span>            :     }
<span class="lineNum">     616 </span>            : /*      IF (LISTL.GE.3) WRITE(FDEBUG,811) IRMS, (IRC(I),I=1,ORDER) */
<span class="lineNum">     617 </span>            : /* 811  FORMAT(1X,'&lt;&lt;DECODE OUT&gt;&gt;',T45,I4,1X,10I8) */
<span class="lineNum">     618 </span>            : /*  Scale RMS and RC's to reals */
<span class="lineNum">     619 </span><span class="lineCov">      50265 :     *rms = (real) (*irms);</span>
<span class="lineNum">     620 </span><span class="lineCov">      50265 :     i__1 = contrl_1.order;</span>
<span class="lineNum">     621 </span><span class="lineCov">     552915 :     for (i__ = 1; i__ &lt;= i__1; ++i__) {</span>
<span class="lineNum">     622 </span><span class="lineCov">     502650 :         rc[i__] = irc[i__] / 16384.f;</span>
<span class="lineNum">     623 </span>            :     }
<span class="lineNum">     624 </span><span class="lineCov">      50265 :     return 0;</span>
<span class="lineNum">     625 </span>            : } /* decode_ */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.13</a></td></tr>
  </table>
  <br>

</body>
</html>
